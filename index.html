<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ğŸ² Dice Mastery</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;600;700&family=Noto+Sans+JP:wght@700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#0f1f17;--surface:#1a3328;--gold:#f5c842;--ink:#1a1a1a;
  --s1:#2980b9;--s1bg:#dbeeff;
  --s2:#27ae60;--s2bg:#d5f5e3;
  --s3:#c9980a;--s3bg:#fef9e7;
  --s4:#e67e22;--s4bg:#fdebd0;
  --s5:#e74c3c;--s5bg:#fadbd8;
  --steal:#8b5cf6;
}
html,body{height:100%;overflow:hidden;font-family:'DM Sans',sans-serif;background:var(--bg);color:#f0ebe0;touch-action:manipulation}

/* â”€â”€â”€ SCREENS â”€â”€â”€ */
.screen{display:none;position:fixed;inset:0}
.screen.active{display:flex;flex-direction:column}


/* â”€â”€â”€ INSTRUCTIONS â”€â”€â”€ */
#instructions{align-items:center;justify-content:center;background:var(--bg)}
.instr-wrap{width:100%;max-width:520px;height:100%;display:flex;flex-direction:column}
.instr-dots{display:flex;gap:6px;justify-content:center;padding:16px 0 8px;flex-shrink:0}
.instr-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.15);transition:all .25s}
.instr-dot.on{background:var(--gold);transform:scale(1.3)}
.instr-slide{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 24px;text-align:center;gap:14px;animation:fadeSlide .25s ease-out}
@keyframes fadeSlide{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.instr-icon{font-size:clamp(3rem,10vw,5rem);line-height:1}
.instr-en{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.5rem,5vw,2.4rem);letter-spacing:.08em;color:var(--gold);line-height:1.1}
.instr-body-en{font-size:clamp(.85rem,2.5vw,1.1rem);color:rgba(240,235,224,.8);line-height:1.65;max-width:400px}
.instr-divider{width:40px;height:2px;background:rgba(245,200,66,.3);border-radius:2px}
.instr-jp{font-family:'Noto Sans JP','Hiragino Sans','YuGothic','Meiryo',sans-serif;font-size:clamp(1rem,3.5vw,1.5rem);color:rgba(240,235,224,.7);line-height:1.3}
.instr-body-jp{font-family:'Noto Sans JP','Hiragino Sans','YuGothic','Meiryo',sans-serif;font-size:clamp(.75rem,2.2vw,.95rem);color:rgba(240,235,224,.5);line-height:1.8;max-width:400px}
.instr-slots{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%;max-width:380px}
.instr-slot-chip{border-radius:10px;padding:10px 12px;display:flex;align-items:center;gap:8px;text-align:left}
.instr-slot-chip .sc-icon{font-size:1.3rem;flex-shrink:0}
.instr-slot-chip .sc-text{display:flex;flex-direction:column;gap:1px}
.instr-slot-chip .sc-en{font-size:.72rem;font-weight:700;letter-spacing:.06em}
.instr-slot-chip .sc-jp{font-family:'Noto Sans JP','Hiragino Sans','YuGothic','Meiryo',sans-serif;font-size:.62rem;opacity:.6}
.instr-nav{display:flex;align-items:center;justify-content:space-between;padding:12px 20px 20px;flex-shrink:0;gap:10px}
.instr-prev{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px 20px;color:rgba(240,235,224,.5);font-family:'DM Sans',sans-serif;font-size:.85rem;font-weight:600;cursor:pointer}
.instr-prev:disabled{opacity:.2;cursor:default}
.instr-next{flex:1;background:var(--gold);border:none;border-radius:10px;padding:13px 20px;color:var(--ink);font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:700;cursor:pointer}
.instr-skip{background:none;border:none;color:rgba(240,235,224,.25);font-size:.7rem;font-family:'DM Sans',sans-serif;cursor:pointer;letter-spacing:.1em;text-transform:uppercase;padding:4px 8px;white-space:nowrap}

/* â”€â”€â”€ SETUP â”€â”€â”€ */
#setup{align-items:center;justify-content:center;gap:16px;padding:20px;background:radial-gradient(ellipse at 50% 0%,#1a3328,var(--bg))}
.logo{font-family:'Bebas Neue',sans-serif;font-size:clamp(2.5rem,8vw,4rem);letter-spacing:.14em;color:var(--gold);text-shadow:0 0 40px rgba(245,200,66,.4);text-align:center;line-height:1}
.logo-sub{font-size:.7rem;font-family:'DM Sans',sans-serif;letter-spacing:.25em;text-transform:uppercase;color:rgba(240,235,224,.3);text-align:center}
.setup-box{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:20px;width:100%;max-width:480px;display:flex;flex-direction:column;gap:12px}
.setup-box h2{font-size:1rem;color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:.1em}
.player-row{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,.2);border-radius:10px;padding:8px 12px;border:1px solid rgba(255,255,255,.08)}
.player-row input{flex:1;background:transparent;border:none;color:#f0ebe0;font-size:1rem;font-family:'DM Sans',sans-serif;outline:none}
.player-row input::placeholder{color:rgba(240,235,224,.25)}
.player-emoji{font-size:1.4rem;cursor:pointer;flex-shrink:0}
.player-remove{background:none;border:none;color:rgba(240,235,224,.3);font-size:1.1rem;cursor:pointer;padding:2px 4px;flex-shrink:0}
.btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:14px 20px;border-radius:12px;border:none;font-family:'DM Sans',sans-serif;font-weight:700;font-size:1rem;cursor:pointer;width:100%}
.btn-gold{background:var(--gold);color:var(--ink)}
.btn-add{background:rgba(255,255,255,.06);border:1px dashed rgba(255,255,255,.2);color:rgba(240,235,224,.5);font-size:.9rem;padding:10px}
.points-row{display:flex;align-items:center;gap:10px;justify-content:space-between}
.points-row label{font-size:.75rem;color:rgba(240,235,224,.5);font-family:'DM Sans',sans-serif}
.points-select{background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.15);border-radius:8px;color:#f0ebe0;padding:6px 12px;font-size:.9rem;font-family:'DM Sans',sans-serif}

/* â”€â”€â”€ SCORE BAR â”€â”€â”€ */
.score-bar{display:flex;gap:6px;padding:8px 10px;background:rgba(0,0,0,.4);border-bottom:1px solid rgba(255,255,255,.07);overflow-x:auto;flex-shrink:0;z-index:10}
.sc{display:flex;flex-direction:column;align-items:center;padding:5px 10px;border-radius:8px;border:2px solid transparent;flex-shrink:0;min-width:60px;transition:border-color .2s,background .2s}
.sc.active{border-color:var(--gold);background:rgba(245,200,66,.1)}
.sc .sa{font-size:1.3rem;line-height:1}
.sc .sn{font-size:.58rem;font-weight:700;max-width:70px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:rgba(240,235,224,.7)}
.sc .sp{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;color:var(--gold);line-height:1}

/* â”€â”€â”€ MAIN SLIDE AREA â”€â”€â”€ */
#game{background:var(--bg)}
.slide-area{flex:1;display:flex;align-items:center;justify-content:center;padding:12px;overflow:hidden}

/* â”€â”€â”€ ROLL SCREEN (whose turn) â”€â”€â”€ */
.roll-card{background:var(--surface);border:3px solid rgba(245,200,66,.25);border-radius:20px;padding:clamp(20px,4vw,40px);display:flex;flex-direction:column;align-items:center;gap:14px;width:100%;max-width:480px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.turn-label{font-size:.7rem;font-family:'DM Sans',sans-serif;text-transform:uppercase;letter-spacing:.2em;color:rgba(240,235,224,.35)}
.turn-animal{font-size:clamp(3rem,10vw,5rem);line-height:1}
.turn-name{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.8rem,6vw,3rem);letter-spacing:.1em;color:var(--gold)}
.die-btn{width:clamp(80px,18vw,110px);height:clamp(80px,18vw,110px);background:#faf7f0;border-radius:18px;border:none;font-size:clamp(2.5rem,8vw,4rem);cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.4),inset 0 2px 0 rgba(255,255,255,.9);display:flex;align-items:center;justify-content:center;transition:transform .1s;flex-shrink:0}
.die-btn:active{transform:scale(.9)}
.die-btn.rolling{animation:spin .45s ease-out}
@keyframes spin{0%{transform:rotate(0)scale(1)}40%{transform:rotate(200deg)scale(1.2)}70%{transform:rotate(380deg)scale(.9)}100%{transform:rotate(360deg)scale(1)}}
.roll-instruction{font-size:.8rem;color:rgba(240,235,224,.4);font-family:'DM Sans',sans-serif}

/* â”€â”€â”€ QUESTION SLIDE â”€â”€â”€ */
.q-card{width:100%;max-width:600px;border-radius:20px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.q-hdr{padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
.q-slot-label{font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.18em;opacity:.8}
.q-card-num{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;opacity:.5}
.q-body{flex:1;padding:clamp(20px,4vw,40px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;text-align:center;min-height:200px}
.q-main{font-family:'Noto Sans JP','DM Sans',sans-serif;font-size:clamp(2rem,7vw,4rem);font-weight:700;line-height:1.2;color:var(--ink);word-break:break-word}
.q-instruction{font-size:clamp(.75rem,2.5vw,1.1rem);color:rgba(26,26,26,.55);font-family:'Noto Sans JP','DM Sans',sans-serif;line-height:1.5}
.q-tap-hint{font-size:.7rem;text-transform:uppercase;letter-spacing:.18em;opacity:.4;font-family:'DM Sans',sans-serif;margin-top:8px}
.q-ftr{padding:10px 20px;display:flex;align-items:center;justify-content:space-between}
.q-player-chip{display:flex;align-items:center;gap:6px;font-size:.8rem}

/* SLOT COLOURS */
.slot-1 .q-hdr,.slot-1 .q-ftr{background:var(--s1bg)}
.slot-1 .q-body{background:white}
.slot-1 .q-hdr{border-bottom:2px solid var(--s1)}.slot-1 .q-slot-label{color:var(--s1)}
.slot-2 .q-hdr,.slot-2 .q-ftr{background:var(--s2bg)}
.slot-2 .q-body{background:white}
.slot-2 .q-hdr{border-bottom:2px solid var(--s2)}.slot-2 .q-slot-label{color:var(--s2)}
.slot-3 .q-hdr,.slot-3 .q-ftr{background:var(--s3bg)}
.slot-3 .q-body{background:white}
.slot-3 .q-hdr{border-bottom:2px solid var(--s3)}.slot-3 .q-slot-label{color:var(--s3)}
.slot-4 .q-hdr,.slot-4 .q-ftr{background:var(--s4bg)}
.slot-4 .q-body{background:white}
.slot-4 .q-hdr{border-bottom:2px solid var(--s4)}.slot-4 .q-slot-label{color:var(--s4)}
.slot-5 .q-hdr,.slot-5 .q-ftr{background:var(--s5bg)}
.slot-5 .q-body{background:white}
.slot-5 .q-hdr{border-bottom:2px solid var(--s5)}.slot-5 .q-slot-label{color:var(--s5)}
.steal-card .q-hdr,.steal-card .q-ftr{background:#2c1654}
.steal-card .q-body{background:#1a0a33}
.steal-card .q-slot-label{color:#e9d5ff}
.steal-card .q-main{color:#e9d5ff}
.steal-card .q-instruction{color:rgba(233,213,255,.55)}

/* â”€â”€â”€ ANSWER SLIDE â”€â”€â”€ */
.a-card{width:100%;max-width:600px;border-radius:20px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.5);animation:flipIn .25s ease-out}
@keyframes flipIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.a-hdr{padding:14px 20px;display:flex;align-items:center;gap:10px}
.a-hdr-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.18em;opacity:.6;font-family:'DM Sans',sans-serif}
.a-body{padding:clamp(16px,4vw,36px);display:flex;flex-direction:column;align-items:center;gap:10px;background:white;text-align:center}
.a-answer{font-family:'DM Sans',sans-serif;font-size:clamp(1.6rem,5vw,3rem);font-weight:700;color:var(--ink);line-height:1.2}
.a-q-recall{font-size:clamp(.75rem,2vw,1rem);color:rgba(26,26,26,.4);font-family:'Noto Sans JP','DM Sans',sans-serif}
.judge-row{padding:12px 16px;display:flex;gap:10px;background:#f5f5f5}
.jbtn{flex:1;padding:14px;border-radius:12px;border:none;font-size:clamp(1rem,3vw,1.4rem);font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:transform .1s,opacity .2s}
.jbtn:active{transform:scale(.95)}
.jbtn.correct{background:#27ae60;color:white}
.jbtn.wrong{background:#e74c3c;color:white}
.jbtn:disabled{opacity:.35;cursor:not-allowed}

/* â”€â”€â”€ POINTS SLIDE â”€â”€â”€ */
.pts-card{background:var(--surface);border:3px solid var(--gold);border-radius:20px;padding:clamp(20px,4vw,40px);display:flex;flex-direction:column;align-items:center;gap:14px;width:100%;max-width:400px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.pts-result{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.4rem,5vw,2.2rem);letter-spacing:.08em;color:#27ae60}
.pts-roll-label{font-size:.8rem;color:rgba(240,235,224,.4);font-family:'DM Sans',sans-serif}
.pts-big{font-family:'Bebas Neue',sans-serif;font-size:clamp(3rem,12vw,6rem);color:var(--gold);line-height:1;text-shadow:0 0 40px rgba(245,200,66,.4)}
.next-btn{width:100%;padding:14px;border-radius:12px;border:none;background:var(--gold);color:var(--ink);font-family:'DM Sans',sans-serif;font-weight:700;font-size:1rem;cursor:pointer}

/* â”€â”€â”€ WRONG SLIDE â”€â”€â”€ */
.wrong-card{background:#2a0a0a;border:3px solid #e74c3c;border-radius:20px;padding:clamp(20px,4vw,40px);display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;max-width:400px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.wrong-icon{font-size:clamp(2.5rem,8vw,4rem)}
.wrong-label{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.6rem,6vw,2.5rem);letter-spacing:.08em;color:#e74c3c}
.wrong-ans{background:rgba(231,76,60,.15);border:1px solid rgba(231,76,60,.3);border-radius:10px;padding:12px 20px;font-size:clamp(.9rem,2.5vw,1.2rem);color:#f5a5a0;font-family:'Noto Sans JP','DM Sans',sans-serif}

/* â”€â”€â”€ STEAL SLIDE â”€â”€â”€ */
.steal-result-card{background:linear-gradient(135deg,#2c1654,#1a0a33);border:3px solid var(--steal);border-radius:20px;padding:clamp(20px,4vw,40px);display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;max-width:400px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.steal-headline{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.8rem,7vw,3rem);letter-spacing:.1em;color:#e9d5ff}
.steal-detail{font-size:.85rem;color:rgba(233,213,255,.6);font-family:'DM Sans',sans-serif}

/* â”€â”€â”€ WIN SCREEN â”€â”€â”€ */
#win{align-items:center;justify-content:center;gap:0;padding:0;background:var(--bg);overflow:hidden}
.win-inner{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:24px;background:radial-gradient(ellipse at 50% 20%,rgba(245,200,66,.18),transparent 65%)}
.win-confetti{font-size:clamp(1.2rem,4vw,2rem);letter-spacing:.15em;text-align:center;animation:confettiBounce 1s ease-out}
@keyframes confettiBounce{0%{transform:scale(0) rotate(-10deg);opacity:0}60%{transform:scale(1.15) rotate(3deg)}100%{transform:scale(1) rotate(0);opacity:1}}
.win-crown{font-size:clamp(3.5rem,12vw,6rem);text-align:center;animation:crownDrop .6s .2s both cubic-bezier(.17,.67,.24,1.4)}
@keyframes crownDrop{from{transform:translateY(-40px) scale(.5);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
.win-label{font-family:'DM Sans',sans-serif;font-size:.7rem;text-transform:uppercase;letter-spacing:.3em;color:rgba(240,235,224,.4);animation:fadeUp .5s .4s both}
.win-name{font-family:'Bebas Neue',sans-serif;font-size:clamp(2.2rem,9vw,4.5rem);letter-spacing:.1em;color:var(--gold);text-align:center;line-height:1;text-shadow:0 0 40px rgba(245,200,66,.5);animation:fadeUp .5s .5s both}
.win-score-badge{background:rgba(245,200,66,.15);border:2px solid rgba(245,200,66,.4);border-radius:50px;padding:8px 24px;font-family:'Bebas Neue',sans-serif;font-size:clamp(1.4rem,5vw,2rem);color:var(--gold);animation:fadeUp .5s .6s both}
.win-jp{font-family:'Noto Sans JP','Hiragino Sans','YuGothic','Meiryo',sans-serif;font-size:clamp(.8rem,2.5vw,1.1rem);color:rgba(240,235,224,.4);animation:fadeUp .5s .65s both}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.final-list{width:100%;max-width:380px;display:flex;flex-direction:column;gap:5px;animation:fadeUp .5s .7s both}
.fl-row{background:rgba(255,255,255,.05);border-radius:10px;padding:10px 16px;display:flex;align-items:center;gap:10px;font-size:clamp(.82rem,2.5vw,1rem)}
.fl-row.top{background:rgba(245,200,66,.12);border:2px solid rgba(245,200,66,.4)}
.fl-pts{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold);margin-left:auto}
.win-divider{width:60px;height:2px;background:rgba(245,200,66,.25);border-radius:2px;animation:fadeUp .5s .68s both}

/* â”€â”€â”€ BOTTOM NAV â”€â”€â”€ */
.bottom-nav{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:rgba(0,0,0,.35);border-top:1px solid rgba(255,255,255,.06);flex-shrink:0}
.bnav-info{font-size:.62rem;font-family:'DM Sans',sans-serif;text-transform:uppercase;letter-spacing:.12em;color:rgba(240,235,224,.25)}
.bnav-btn{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);border-radius:8px;padding:6px 14px;color:rgba(240,235,224,.5);font-size:.7rem;font-family:'DM Sans',sans-serif;cursor:pointer}
.bnav-btn:hover{border-color:rgba(240,235,224,.3);color:rgba(240,235,224,.8)}
</style>
</head>
<body>

<!-- â•â• INSTRUCTIONS â•â• -->
<div id="instructions" class="screen active">
  <div class="instr-wrap">
    <div class="instr-dots" id="instr-dots"></div>
    <div class="instr-slide" id="instr-slide"></div>
    <div class="instr-nav">
      <button class="instr-prev" id="instr-prev" onclick="instrPrev()">â† Back</button>
      <button class="instr-next" id="instr-next" onclick="instrNext()">Next â†’</button>
      <button class="instr-skip" onclick="skipInstr()">Skip</button>
    </div>
  </div>
</div>

<!-- â•â• SETUP â•â• -->
<div id="setup" class="screen">
  <div class="logo">ğŸ²<br>DICE<br>MASTERY</div>
  <div class="logo-sub">Classroom Slideshow Edition</div>
  <div class="setup-box">
    <h2>PLAYERS</h2>
    <div id="player-rows"></div>
    <button class="btn btn-add" onclick="addPlayer()" id="add-btn">ï¼‹ Add Player</button>
    <div class="points-row">
      <label>First to reach:</label>
      <select class="points-select" id="target-pts">
        <option value="10">10 points</option>
        <option value="15">15 points</option>
        <option value="20" selected>20 points</option>
        <option value="30">30 points</option>
      </select>
    </div>
    <button class="btn btn-gold" onclick="startGame()">â–¶ Start Game</button>
  </div>
</div>

<!-- â•â• GAME â•â• -->
<div id="game" class="screen">
  <div class="score-bar" id="score-bar"></div>
  <div class="slide-area" id="slide-area"></div>
  <div class="bottom-nav">
    <div class="bnav-info" id="bnav-info">Round 1</div>
    <button class="bnav-btn" onclick="showSetup()">âš™ Restart</button>
  </div>
</div>

<!-- â•â• WIN â•â• -->
<div id="win" class="screen">
  <div class="win-inner">
    <div class="win-confetti">ğŸŠ ğŸ‰ ğŸŠ</div>
    <div class="win-crown" id="win-crown">ğŸ†</div>
    <div class="win-label">WINNER / å„ªå‹è€…</div>
    <div class="win-name" id="win-name"></div>
    <div class="win-score-badge" id="win-score"></div>
    <div class="win-jp" id="win-jp">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</div>
    <div class="win-divider"></div>
    <div class="final-list" id="final-list"></div>
    <button class="btn btn-gold" style="max-width:300px;margin-top:8px" onclick="showSetup()">ğŸ”„ Play Again</button>
  </div>
</div>

<script>
// â•â•â• DATA â•â•â•
const ANIMALS = ['ğŸ•','ğŸˆ','ğŸ¸','ğŸ”','ğŸ‡','ğŸ„'];
const DIE = ['','âš€','âš','âš‚','âšƒ','âš„','âš…'];
const SLOT_NAMES = {1:'Visual ğŸ–¼',2:'Translation ğŸ“–',3:'Spelling âœï¸',4:'Sentence ğŸ’¬',5:'Synthesis â­'};
const STEAL_SPACES = new Set([9,19,29,39]);

const CARDS = {
  1:[
    {q:'ğŸ¥©',i:'What food is this? / ã“ã‚Œã¯è‹±èªã§ï¼Ÿ',a:'Steak'},
    {q:'ğŸ³',i:'What is this? / ã“ã‚Œã¯è‹±èªã§ï¼Ÿ',a:'Fried egg'},
    {q:'ğŸŒ§ï¸',i:'What weather? / ã“ã®å¤©æ°—ã¯è‹±èªã§ï¼Ÿ',a:'Rain / Rainy'},
    {q:'ğŸ„',i:'What animal? / ã“ã®å‹•ç‰©ã¯è‹±èªã§ï¼Ÿ',a:'Cow / Bull'},
    {q:'ğŸ‹ï¸',i:'What activity? / ã“ã®æ´»å‹•ã¯è‹±èªã§ï¼Ÿ',a:'Weightlifting'},
    {q:'ğŸšŒ',i:'What vehicle? / ã“ã®ä¹—ã‚Šç‰©ã¯è‹±èªã§ï¼Ÿ',a:'Bus'},
    {q:'ğŸŒ¸',i:'What is this? / ã“ã‚Œã¯è‹±èªã§ï¼Ÿ',a:'Cherry blossom / Spring'},
    {q:'â•ğŸ”¢',i:'What school subject? / ã“ã®æ•™ç§‘ã¯è‹±èªã§ï¼Ÿ',a:'Math / Mathematics'},
    {q:'ğŸ”¬',i:'What subject? / ã“ã®æ•™ç§‘ã¯è‹±èªã§ï¼Ÿ',a:'Science'},
    {q:'ğŸ‘¨â€ğŸš€',i:'What job? / ã“ã®ä»•äº‹ã¯è‹±èªã§ï¼Ÿ',a:'Astronaut'},
    {q:'ğŸ‘®',i:'What job? / ã“ã®è·æ¥­ã¯è‹±èªã§ï¼Ÿ',a:'Police Officer'},
    {q:'ğŸ‘‘',i:'What person? / ã“ã®äººã¯è‹±èªã§ï¼Ÿ',a:'King'},
    {q:'ğŸ—',i:'What food? / ã“ã®é£Ÿã¹ç‰©ã¯è‹±èªã§ï¼Ÿ',a:'Fried Chicken'},
    {q:'ğŸ°',i:'What building? / ã“ã®å»ºç‰©ã¯è‹±èªã§ï¼Ÿ',a:'Castle'},
    {q:'ğŸ¸',i:'What sport? / ã“ã®ã‚¹ãƒãƒ¼ãƒ„ã¯è‹±èªã§ï¼Ÿ',a:'Badminton'},
  ],
  2:[
    {q:'ãªãœ',i:'What does this mean in English? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Why'},
    {q:'ã„ã¤',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'When'},
    {q:'ã©ã“',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Where'},
    {q:'ã ã‚Œ',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Who'},
    {q:'ã©ã†ã‚„ã£ã¦',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'How'},
    {q:'ã„ãã‚‰',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'How much'},
    {q:'ã©ã‚Œãã‚‰ã„',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'How long / How far'},
    {q:'ãƒ¯ãƒ‹',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Crocodile'},
    {q:'å…«æœˆ',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'August'},
    {q:'é‡çƒãƒãƒ¼ãƒ ',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Baseball Team'},
    {q:'ç§‘å­¦',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Science'},
    {q:'é‹å‹•ä¼š',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Sports Day'},
    {q:'æœˆæ›œæ—¥',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Monday'},
    {q:'æ³³ã',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Swim / Swimming'},
    {q:'ãŠã˜ã„ã•ã‚“',i:'What does this mean? / è‹±èªã§ä½•ã¨è¨€ã„ã¾ã™ã‹ï¼Ÿ',a:'Grandfather'},
  ],
  3:[
    {q:'æœé£Ÿ',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'BÂ·RÂ·EÂ·AÂ·KÂ·FÂ·AÂ·SÂ·T'},
    {q:'å›³æ›¸é¤¨',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'LÂ·IÂ·BÂ·RÂ·AÂ·RÂ·Y'},
    {q:'ç—…é™¢',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'HÂ·OÂ·SÂ·PÂ·IÂ·TÂ·AÂ·L'},
    {q:'é§…',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'SÂ·TÂ·AÂ·TÂ·IÂ·OÂ·N'},
    {q:'å­¦æ ¡',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'SÂ·CÂ·HÂ·OÂ·OÂ·L'},
    {q:'å‹é”',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'FÂ·RÂ·IÂ·EÂ·NÂ·D'},
    {q:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'RÂ·EÂ·SÂ·TÂ·AÂ·UÂ·RÂ·AÂ·NÂ·T'},
    {q:'é’',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'BÂ·LÂ·UÂ·E'},
    {q:'å¸½å­',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'CÂ·AÂ·P'},
    {q:'çŒ«',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'CÂ·AÂ·T'},
    {q:'ã‚¨ã‚¸ãƒ—ãƒˆ',i:'Spell this country. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'EÂ·GÂ·YÂ·PÂ·T'},
    {q:'ä¸­å›½',i:'Spell this country. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'CÂ·HÂ·IÂ·NÂ·A'},
    {q:'å…­æœˆ',i:'Spell this month. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'JÂ·UÂ·NÂ·E'},
    {q:'ãƒ’ãƒ¼ãƒ­ãƒ¼',i:'Spell it in English. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'HÂ·EÂ·RÂ·O'},
    {q:'ãƒãƒ³',i:'Spell this vehicle. / è‹±èªã®ã‚¹ãƒšãƒ«ã¯ï¼Ÿ',a:'VÂ·AÂ·N'},
  ],
  4:[
    {q:'ç§ã¯ãµã ã‚“å®¿é¡Œã‚’ã—ã¾ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I usually do my homework."'},
    {q:'å½¼å¥³ã¯æ¯æ—¥è‹±èªã‚’å‹‰å¼·ã—ã¾ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"She studies English every day."'},
    {q:'ç§ãŸã¡ã¯å…¬åœ’ã§éŠã³ã¾ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"We play in the park."'},
    {q:'å½¼ã¯éŸ³æ¥½ã‚’è´ãã®ãŒå¥½ãã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"He likes listening to music."'},
    {q:'ä»Šæ—¥ã¯å¤©æ°—ãŒã„ã„ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"The weather is good today."'},
    {q:'ç§ã¯å°†æ¥ã€åŒ»è€…ã«ãªã‚ŠãŸã„ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I want to become a doctor."'},
    {q:'é€±æœ«ã«å®¶æ—ã¨è²·ã„ç‰©ã«è¡Œãã¾ã—ãŸã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I went shopping with my family."'},
    {q:'ç§ã¯ä½“è‚²ãŒå¥½ãã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I like P.E."'},
    {q:'ç§ã¯é€Ÿãèµ°ã‚Œã¾ã›ã‚“ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I can\'t run fast."'},
    {q:'å½¼å¥³ã¯ç§ã®æ¯ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"She is my mother."'},
    {q:'ç§ãŸã¡ã«ã¯ç´ æ•µãªå…¬åœ’ãŒã‚ã‚Šã¾ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"We have a nice park."'},
    {q:'å·¦å´ã«è¦‹ãˆã¾ã™ã‚ˆã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"You can see it on your left."'},
    {q:'ä¸­è¯è¡—ã‚’è¦‹ãŸã„ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"I want to see Chinatown."'},
    {q:'å½¼ã¯æ­Œã†ã®ãŒå¾—æ„ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"He is good at singing."'},
    {q:'å½¼å¥³ã¯ç§ã®å‹é”ã§ã™ã€‚',i:'Translate to English. / è‹±èªã«è¨³ã—ã¦ãã ã•ã„ã€‚',a:'"She is my friend."'},
  ],
  5:[
    {q:'"My favorite _____ is _____."',i:'Complete the sentence aloud. / å£°ã«å‡ºã—ã¦å®Œæˆã•ã›ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” teacher judges'},
    {q:'3 things you did yesterday',i:'Say in English using past tense. / éå»å½¢ã§3ã¤è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” 3 past-tense sentences'},
    {q:"Today's weather",i:'Describe in one full sentence. / ä¸€æ–‡ã§èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” complete sentence'},
    {q:'"I enjoy ___ing..."',i:'Complete and say aloud. / å®Œæˆã•ã›ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” gerund form'},
    {q:'Introduce yourself',i:'Two sentences about you. / è‡ªå·±ç´¹ä»‹ã‚’2æ–‡ã§ã€‚',a:'âœ¦ Oral â€” name + one fact'},
    {q:'Your weekend plans',i:'Use "will". / "will"ã‚’ä½¿ã£ã¦ã€‚',a:'âœ¦ Oral â€” future tense'},
    {q:'Compare two things',i:'Use "better than because". / æ¯”è¼ƒç´šã‚’ä½¿ã£ã¦ã€‚',a:'âœ¦ Oral â€” comparative'},
    {q:'"I want to go to _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” any place'},
    {q:'"I like _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” any noun'},
    {q:'"My birthday is _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” month and day'},
    {q:'"I\'d like _____ and _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” two items'},
    {q:'"I want to go ___ing."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” gerund'},
    {q:'"I want a _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” any noun'},
    {q:'"I can _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” base verb'},
    {q:'"He / She is _____."',i:'Complete aloud. / å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã†ã€‚',a:'âœ¦ Oral â€” describe a person'},
  ],
};

// â•â•â• STATE â•â•â•
let players=[], currentIdx=0, round=1, targetPts=20;
let deck={}, phase='roll'; // roll | question | answer | points | wrong | steal
let currentCard=null, currentSlot=0, positions=[];
let stealAmt=0;

// â•â•â• SETUP â•â•â•
function init(){
  const rows = document.getElementById('player-rows');
  rows.innerHTML='';
  [['You',''],['Player 2',''],['Player 3','']].forEach(([name],i)=>{
    addPlayer(name);
  });
}

function addPlayer(defaultName=''){
  const rows=document.getElementById('player-rows');
  if(rows.children.length>=6){document.getElementById('add-btn').style.display='none';return;}
  const idx=rows.children.length;
  const animal=ANIMALS[idx]||ANIMALS[0];
  const div=document.createElement('div');
  div.className='player-row';
  div.dataset.animal=animal;
  div.innerHTML=`
    <span class="player-emoji" onclick="cycleAnimal(this)">${animal}</span>
    <input placeholder="Player ${idx+1} name" value="${defaultName}">
    <button class="player-remove" onclick="removePlayer(this)">âœ•</button>`;
  rows.appendChild(div);
  if(rows.children.length>=6) document.getElementById('add-btn').style.display='none';
}

function removePlayer(btn){
  const row=btn.closest('.player-row');
  row.remove();
  document.getElementById('add-btn').style.display='';
}

function cycleAnimal(el){
  const cur=ANIMALS.indexOf(el.textContent);
  el.textContent=ANIMALS[(cur+1)%ANIMALS.length];
  el.closest('.player-row').dataset.animal=el.textContent;
}

function startGame(){
  const rows=[...document.querySelectorAll('.player-row')];
  players=rows.map((r,i)=>({
    name:r.querySelector('input').value.trim()||`Player ${i+1}`,
    animal:r.dataset.animal,
    points:0
  })).filter(p=>p.name);
  if(players.length<1){alert('Add at least 1 player!');return;}
  targetPts=parseInt(document.getElementById('target-pts').value);
  // Build shuffled decks
  deck={};
  for(let s=1;s<=5;s++) deck[s]=shuffle([...Array(CARDS[s].length).keys()]);
  positions=players.map(()=>1);
  currentIdx=0; round=1; phase='roll';
  document.querySelector('.screen.active').classList.remove('active');
  document.getElementById('game').classList.add('active');
  render();
}

function showSetup(){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('setup').classList.add('active');
}

// â•â•â• SHUFFLE â•â•â•
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function d6(){return Math.ceil(Math.random()*6);}

// â•â•â• DRAW CARD â•â•â•
function drawCard(slot){
  if(!deck[slot]||deck[slot].length===0){
    // Reshuffle
    deck[slot]=shuffle([...Array(CARDS[slot].length).keys()]);
  }
  const idx=deck[slot].pop();
  return {...CARDS[slot][idx],slot};
}

// â•â•â• RENDER â•â•â•
function render(){
  renderScoreBar();
  renderSlide();
  document.getElementById('bnav-info').textContent=`Round ${round} Â· ${players[currentIdx].name}'s turn`;
}

function renderScoreBar(){
  document.getElementById('score-bar').innerHTML=players.map((p,i)=>`
    <div class="sc${i===currentIdx?' active':''}">
      <div class="sa">${p.animal}</div>
      <div class="sn">${p.name}</div>
      <div class="sp">${p.points}</div>
    </div>`).join('');
}

function renderSlide(){
  const p=players[currentIdx];
  const area=document.getElementById('slide-area');

  if(phase==='roll'){
    area.innerHTML=`
      <div class="roll-card">
        <div class="turn-label">It's your turn!</div>
        <div class="turn-animal">${p.animal}</div>
        <div class="turn-name">${p.name}</div>
        <div class="roll-instruction">Tap the die to roll and move</div>
        <div class="die-btn" id="move-die" onclick="rollMove()">ğŸ²</div>
      </div>`;
  }

  else if(phase==='question'){
    const c=currentCard;
    const isSteal=c.steal;
    const cls=isSteal?'steal-card':`slot-${c.slot}`;
    const slotLabel=isSteal?'ğŸ¯ STEAL SPACE':SLOT_NAMES[c.slot];
    area.innerHTML=`
      <div class="q-card ${cls}" onclick="revealAnswer()">
        <div class="q-hdr">
          <span class="q-slot-label">${slotLabel}</span>
          <span class="q-card-num">${p.animal} ${p.name}</span>
        </div>
        <div class="q-body">
          <div class="q-main">${c.q}</div>
          <div class="q-instruction">${c.i}</div>
          <div class="q-tap-hint">tap to reveal answer</div>
        </div>
        <div class="q-ftr">
          <div class="q-player-chip"><span>${p.animal}</span><span>${p.name}</span></div>
          <div style="font-size:.65rem;opacity:.4;font-family:'DM Sans',sans-serif">Slot ${c.slot}</div>
        </div>
      </div>`;
  }

  else if(phase==='answer'){
    const c=currentCard;
    const cls=`slot-${c.slot}`;
    const color=['','var(--s1)','var(--s2)','var(--s3)','var(--s4)','var(--s5)'][c.slot];
    area.innerHTML=`
      <div class="a-card ${cls}">
        <div class="a-hdr" style="background:${color}20;border-bottom:2px solid ${color}">
          <span style="font-size:1.2rem">${p.animal}</span>
          <div>
            <div class="a-hdr-label">${SLOT_NAMES[c.slot]}</div>
          </div>
        </div>
        <div class="a-body">
          <div class="a-q-recall">${c.q}</div>
          <div class="a-answer">${c.a}</div>
        </div>
        <div class="judge-row">
          <button class="jbtn correct" onclick="judgeCorrect()">âœ… Correct</button>
          <button class="jbtn wrong" onclick="judgeWrong()">âŒ Wrong</button>
        </div>
      </div>`;
  }

  else if(phase==='points'){
    area.innerHTML=`
      <div class="pts-card">
        <div class="pts-result">âœ… CORRECT!</div>
        <div class="turn-animal">${p.animal}</div>
        <div class="pts-roll-label">${p.name} â€” tap the die to earn points</div>
        <div class="die-btn" id="pts-die" onclick="rollPoints()">ğŸ²</div>
      </div>`;
  }

  else if(phase==='wrong'){
    area.innerHTML=`
      <div class="wrong-card">
        <div class="wrong-icon">âŒ</div>
        <div class="wrong-label">INCORRECT</div>
        <div class="wrong-ans">Answer: ${currentCard.a}</div>
        <button class="next-btn" style="margin-top:8px;background:#e74c3c;color:white" onclick="nextPlayer()">Next Player â†’</button>
      </div>`;
  }

  else if(phase==='steal'){
    const victim=players.reduce((best,p,i)=>p.points>players[best].points?i:best,
      (currentIdx+1)%players.length);
    const vp=players[victim];
    area.innerHTML=`
      <div class="steal-result-card">
        <div style="font-size:2.5rem">ğŸ¯</div>
        <div class="steal-headline">STEAL!</div>
        <div class="turn-animal">${p.animal}</div>
        <div class="steal-detail">${p.name} answered correctly!<br>Tap die to steal from <strong>${vp.animal} ${vp.name}</strong></div>
        <div class="die-btn" id="steal-die" onclick="rollSteal(${victim})">ğŸ²</div>
      </div>`;
  }

  else if(phase==='steal_result'){
    const victim=stealVictim;
    const vp=players[victim];
    area.innerHTML=`
      <div class="steal-result-card">
        <div style="font-size:2.5rem">ğŸ’¸</div>
        <div class="steal-headline">${p.name} STEALS ${stealAmt}!</div>
        <div class="steal-detail">âˆ’${stealAmt} from ${vp.animal} ${vp.name}<br>${vp.name} now has ${vp.points} pts</div>
        <button class="next-btn" style="margin-top:12px" onclick="nextPlayer()">Next Player â†’</button>
      </div>`;
  }
}

// â•â•â• GAME ACTIONS â•â•â•
let stealVictim=-1;

function rollMove(){
  const die=document.getElementById('move-die');
  if(!die)return;
  die.classList.add('rolling');
  setTimeout(()=>{
    die.classList.remove('rolling');
    const roll=d6();
    positions[currentIdx]=Math.min(positions[currentIdx]+roll,40);
    const pos=positions[currentIdx];
    if(pos>=40){endGame();return;}
    const slot=STEAL_SPACES.has(pos)?'steal':((pos-2)%5)+1;
    currentCard=drawCard(slot==='steal'?Math.ceil(Math.random()*5):slot);
    if(slot==='steal') currentCard.steal=true;
    phase='question';
    render();
  },480);
}

function revealAnswer(){
  phase='answer';
  render();
}

function judgeCorrect(){
  // Disable buttons immediately
  document.querySelectorAll('.jbtn').forEach(b=>b.disabled=true);
  if(currentCard.steal){
    // Find victim (player with most points, not self)
    const others=players.map((p,i)=>({i,pts:p.points})).filter(p=>p.i!==currentIdx);
    if(!others.length){phase='points';render();return;}
    stealVictim=others.sort((a,b)=>b.pts-a.pts)[0].i;
    phase='steal';
  } else {
    phase='points';
  }
  render();
}

function judgeWrong(){
  document.querySelectorAll('.jbtn').forEach(b=>b.disabled=true);
  phase='wrong';
  render();
}

function rollPoints(){
  const die=document.getElementById('pts-die');
  if(!die)return;
  die.classList.add('rolling');
  setTimeout(()=>{
    die.classList.remove('rolling');
    const roll=d6();
    die.textContent=DIE[roll];
    players[currentIdx].points+=roll;
    setTimeout(()=>{
      if(players[currentIdx].points>=targetPts){endGame();return;}
      // Show points earned
      const area=document.getElementById('slide-area');
      const p=players[currentIdx];
      area.querySelector('.pts-card').innerHTML=`
        <div class="pts-result">+${roll} POINTS!</div>
        <div class="pts-big">${roll}</div>
        <div class="pts-roll-label">${p.name} now has ${p.points} pts</div>
        <button class="next-btn" onclick="nextPlayer()">Next Player â†’</button>`;
    },300);
    renderScoreBar();
  },480);
}

let stealRoll=0;
function rollSteal(victimIdx){
  const die=document.getElementById('steal-die');
  if(!die)return;
  die.classList.add('rolling');
  setTimeout(()=>{
    die.classList.remove('rolling');
    const roll=d6();
    die.textContent=DIE[roll];
    stealAmt=roll;
    players[currentIdx].points+=roll;
    players[victimIdx].points-=roll; // can go negative
    renderScoreBar();
    setTimeout(()=>{
      stealVictim=victimIdx;
      phase='steal_result';
      if(players[currentIdx].points>=targetPts){endGame();return;}
      render();
    },400);
  },480);
}

function nextPlayer(){
  currentIdx=(currentIdx+1)%players.length;
  if(currentIdx===0) round++;
  phase='roll';
  render();
}

// â•â•â• END â•â•â•
function endGame(){
  const sorted=[...players].map((p,i)=>({...p,origIdx:i})).sort((a,b)=>b.points-a.points);
  const winner=sorted[0];
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£'];

  // Safely set each element only if it exists
  const set = (id, val, prop='textContent') => {
    const el = document.getElementById(id);
    if(el) el[prop] = val;
  };

  set('win-name',  winner.animal + ' ' + winner.name);
  set('win-crown', 'ğŸ†');
  set('win-score', winner.points + ' POINTS');
  set('win-jp',    winner.name + 'ã•ã‚“ã€ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼');
  set('final-list', sorted.map((p,i)=>`
    <div class="fl-row${i===0?' top':''}">
      <span>${medals[i]||''}</span>
      <span style="font-size:1.3rem">${p.animal}</span>
      <span style="flex:1;font-weight:${i===0?'700':'400'}">${p.name}</span>
      <span class="fl-pts">${p.points} pts</span>
    </div>`).join(''), 'innerHTML');

  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('win').classList.add('active');
}


// â•â•â• INSTRUCTIONS â•â•â•
const INSTR_SLIDES = [
  {
    icon: 'ğŸ²',
    en: 'WELCOME TO DICE MASTERY',
    bodyEn: 'A classroom English game for 1â€“6 players.<br>Answer questions, earn points, steal from your rivals!',
    jp: 'ãƒ€ã‚¤ã‚¹ãƒ»ãƒã‚¹ã‚¿ãƒªãƒ¼ã¸ã‚ˆã†ã“ãï¼',
    bodyJp: '1ã€œ6äººã§éŠã¹ã‚‹è‹±èªã®æˆæ¥­ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>è³ªå•ã«ç­”ãˆã¦ãƒã‚¤ãƒ³ãƒˆã‚’ç¨¼ãã€ãƒ©ã‚¤ãƒãƒ«ã‹ã‚‰å¥ªã„å–ã‚ã†ï¼',
    extra: null
  },
  {
    icon: 'ğŸ†',
    en: 'HOW TO WIN',
    bodyEn: 'Be the first player to reach the target score.<br>The teacher sets the target â€” 10, 15, 20 or 30 points.',
    jp: 'å‹ã¡æ–¹',
    bodyJp: 'ç›®æ¨™ãƒã‚¤ãƒ³ãƒˆã«æœ€åˆã«åˆ°é”ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹ã¡ã§ã™ã€‚<br>å…ˆç”ŸãŒç›®æ¨™ã‚’è¨­å®šã—ã¾ã™ï¼ˆ10ãƒ»15ãƒ»20ãƒ»30ç‚¹ï¼‰ã€‚',
    extra: null
  },
  {
    icon: 'ğŸ“‹',
    en: 'THE 5 CARD SLOTS',
    bodyEn: 'Each turn you land on a space numbered 1â€“5.<br>That number tells you which card pile to draw from.',
    jp: '5ã¤ã®ã‚«ãƒ¼ãƒ‰ã‚¹ãƒ­ãƒƒãƒˆ',
    bodyJp: 'æ¯ã‚¿ãƒ¼ãƒ³ã€1ã€œ5ç•ªã®ãƒã‚¹ã«æ­¢ã¾ã‚Šã¾ã™ã€‚<br>ãã®ç•ªå·ã®ã‚«ãƒ¼ãƒ‰ã®å±±ã‹ã‚‰å¼•ãã¾ã™ã€‚',
    extra: 'slots'
  },
  {
    icon: 'ğŸ¯',
    en: 'YOUR TURN â€” 4 STEPS',
    bodyEn: '<strong>â‘  Roll</strong> the die â€” your piece moves that many spaces.<br><strong>â‘¡ Read</strong> the card question aloud.<br><strong>â‘¢ Answer</strong> â€” teacher taps âœ… Correct or âŒ Wrong.<br><strong>â‘£ Roll again</strong> for points if correct!',
    jp: 'ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ â€” 4ã‚¹ãƒ†ãƒƒãƒ—',
    bodyJp: '<strong>â‘  ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</strong> â€” ãã®æ•°ã ã‘é§’ãŒé€²ã¿ã¾ã™ã€‚<br><strong>â‘¡ ã‚«ãƒ¼ãƒ‰ã‚’èª­ã‚€</strong> â€” è³ªå•ã‚’å£°ã«å‡ºã—ã¦èª­ã¿ã¾ã—ã‚‡ã†ã€‚<br><strong>â‘¢ ç­”ãˆã‚‹</strong> â€” å…ˆç”ŸãŒâœ…æ­£è§£ã¾ãŸã¯âŒä¸æ­£è§£ã‚’æŠ¼ã—ã¾ã™ã€‚<br><strong>â‘£ å†åº¦æŒ¯ã‚‹</strong> â€” æ­£è§£ã—ãŸã‚‰ãƒã‚¤ãƒ³ãƒˆã®ãŸã‚ã«ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚Šã¾ã™ï¼',
    extra: null
  },
  {
    icon: 'ğŸ¯',
    en: 'STEAL SPACE!',
    bodyEn: 'Land on a <strong>ğŸ¯ Steal Space</strong> and answer correctly.<br>Then roll the die â€” steal that many points from the player with the most points!<br><span style="color:#f5837a;font-size:.85em">âš  Their score can go negative!</span>',
    jp: 'ã‚¹ãƒãƒ¼ãƒ«ã‚¹ãƒšãƒ¼ã‚¹ï¼',
    bodyJp: '<strong>ğŸ¯ ã‚¹ãƒãƒ¼ãƒ«ã‚¹ãƒšãƒ¼ã‚¹</strong>ã«æ­¢ã¾ã£ã¦æ­£è§£ã™ã‚‹ã¨â€¦<br>ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ã¦ã€æœ€ã‚‚ãƒã‚¤ãƒ³ãƒˆã®é«˜ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ãã®æ•°ã‚’å¥ªã„ã¾ã™ï¼<br><span style="color:#f5837a;font-size:.85em">âš  ç›¸æ‰‹ã®ã‚¹ã‚³ã‚¢ã¯ãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ï¼</span>',
    extra: null
  },
  {
    icon: 'â­',
    en: 'SLOT 5 â€” SPEAK UP!',
    bodyEn: 'Slot 5 cards are <strong>oral answers</strong>.<br>Say your answer aloud â€” the teacher decides if it is correct.<br>These are worth the most because they are the hardest!',
    jp: 'ã‚¹ãƒ­ãƒƒãƒˆ5 â€” å£°ã«å‡ºãã†ï¼',
    bodyJp: 'ã‚¹ãƒ­ãƒƒãƒˆ5ã®ã‚«ãƒ¼ãƒ‰ã¯<strong>å£é ­ã§ã®å›ç­”</strong>ã§ã™ã€‚<br>ç­”ãˆã‚’å£°ã«å‡ºã—ã¦è¨€ã„ã¾ã—ã‚‡ã† â€” å…ˆç”ŸãŒæ­£è§£ã‹ã©ã†ã‹åˆ¤æ–­ã—ã¾ã™ã€‚<br>ä¸€ç•ªé›£ã—ã„ã®ã§ã€ä¸€ç•ªä¾¡å€¤ãŒã‚ã‚Šã¾ã™ï¼',
    extra: null
  },
];

let instrIdx = 0;

function renderInstrSlide(){
  const s = INSTR_SLIDES[instrIdx];
  const total = INSTR_SLIDES.length;

  // Dots
  document.getElementById('instr-dots').innerHTML = INSTR_SLIDES.map((_,i) =>
    `<div class="instr-dot${i===instrIdx?' on':''}"></div>`).join('');

  // Next button label
  const nextBtn = document.getElementById('instr-next');
  nextBtn.textContent = instrIdx === total-1 ? "Lets Play! â†’" : "Next â†’";

  // Prev button
  document.getElementById('instr-prev').disabled = instrIdx === 0;

  // Slide content
  let extra = '';
  if(s.extra === 'slots'){
    extra = `<div class="instr-slots">
      <div class="instr-slot-chip" style="background:rgba(41,128,185,.15);border:1px solid rgba(41,128,185,.3)">
        <span class="sc-icon">ğŸ–¼</span>
        <div class="sc-text"><span class="sc-en" style="color:#7ec8f5">Slot 1 Â· Visual</span><span class="sc-jp">çµµã‚’è¦‹ã¦ç­”ãˆã‚‹</span></div>
      </div>
      <div class="instr-slot-chip" style="background:rgba(39,174,96,.15);border:1px solid rgba(39,174,96,.3)">
        <span class="sc-icon">ğŸ“–</span>
        <div class="sc-text"><span class="sc-en" style="color:#6edd9f">Slot 2 Â· Translation</span><span class="sc-jp">æ—¥æœ¬èªâ†’è‹±èªã«è¨³ã™</span></div>
      </div>
      <div class="instr-slot-chip" style="background:rgba(201,152,10,.15);border:1px solid rgba(201,152,10,.3)">
        <span class="sc-icon">âœï¸</span>
        <div class="sc-text"><span class="sc-en" style="color:#f5c842">Slot 3 Â· Spelling</span><span class="sc-jp">è‹±èªã®ã‚¹ãƒšãƒ«ã‚’æ›¸ã</span></div>
      </div>
      <div class="instr-slot-chip" style="background:rgba(230,126,34,.15);border:1px solid rgba(230,126,34,.3)">
        <span class="sc-icon">ğŸ’¬</span>
        <div class="sc-text"><span class="sc-en" style="color:#f5a55a">Slot 4 Â· Sentence</span><span class="sc-jp">æ–‡ç« ã‚’è‹±èªã«è¨³ã™</span></div>
      </div>
      <div class="instr-slot-chip" style="background:rgba(231,76,60,.15);border:1px solid rgba(231,76,60,.3);grid-column:1/-1">
        <span class="sc-icon">â­</span>
        <div class="sc-text"><span class="sc-en" style="color:#f5837a">Slot 5 Â· Synthesis (Oral)</span><span class="sc-jp">å£°ã«å‡ºã—ã¦è‡ªç”±ã«ç­”ãˆã‚‹</span></div>
      </div>
    </div>`;
  }

  document.getElementById('instr-slide').innerHTML = `
    <div class="instr-icon">${s.icon}</div>
    <div class="instr-en">${s.en}</div>
    <div class="instr-body-en">${s.bodyEn}</div>
    ${extra}
    <div class="instr-divider"></div>
    <div class="instr-jp">${s.jp}</div>
    <div class="instr-body-jp">${s.bodyJp}</div>
  `;
}

function instrNext(){
  if(instrIdx < INSTR_SLIDES.length - 1){
    instrIdx++;
    renderInstrSlide();
  } else {
    skipInstr();
  }
}

function instrPrev(){
  if(instrIdx > 0){
    instrIdx--;
    renderInstrSlide();
  }
}

function skipInstr(){
  document.getElementById('instructions').classList.remove('active');
  document.getElementById('setup').classList.add('active');
}

// â•â•â• INIT â•â•â•
renderInstrSlide();
init();
</script>
</body>
</html>
